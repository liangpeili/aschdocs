# 理解主链和Dapp账户

由于采用了侧链技术， 阿希上的每一个应用(Dapp)都由一个独立的链来承载。 Dapp主链和阿希主链之间、Dapp主链和其他Dapp主链之间都是独立的，只能通过主链进行数据的互通。本篇重点讨论主链账户与Dapp账户间的关系。

## 一、 Dapp 普通账户和阿希普通账户

阿希和基于Dapp的账户体系是一致的，都是基于 BIP39 随机生成主密码（由12个英文单词构成）， 然后根据主密码计算出公钥和账户地址。 一个主密码可以登录主链的钱包和侧链的Dapp， 而账户地址可以用于接收和发送 Token。 

阿希支持一币多链，也就是主链上发行的资产可以充值到侧链的Dapp中。 对于一个用户的某项资产来说，这项资产 可以处于阿希的主链中(此时会在阿希钱包中显示余额)， 也可以转移到侧链的Dapp里（此时需要到Dapp里查询资产余额，主链不会显示）。

如何向Dapp进行充值呢？
1. 登录阿希主钱包，确保想要充值的资产有足够的余额；
2. 登录安装了Dapp应用的主网节点， 此时在“应用中心”->“已安装应用”里应用能看到自己想要充值的应用，如下图所示：
![app](http://asch-public.oss-cn-beijing.aliyuncs.com/markdown/TIM%E6%88%AA%E5%9B%BE20180126150833.png)
3. 点击“充值”，然后选择充值币种及数量，即可完成充值。这里我们充值121 XAS.
4. 使用同一主密码登录Dapp，即可看到Dapp中的资产余额，如下图所示：
![dapp](http://asch-public.oss-cn-beijing.aliyuncs.com/markdown/TIM%E6%88%AA%E5%9B%BE20180126151101.png)
5. 此时用户登录阿希主钱包，会发现余额已经扣除121  XAS.

## 二、Dapp系统用户
参加过阿希技术分享的同学可能看过下面这张图：

![app](http://asch-public.oss-cn-beijing.aliyuncs.com/markdown/TIM%E6%88%AA%E5%9B%BE20180126144656.png)
 

初看这张图，很多人以为在主链和侧链Dapp上分别存在一个叫做“DAPP账户”和“系统账户”的东西，并且有个主密码和它相对应，其实这种理解是不对的。

任何一个Dapp注册到主链上时，都会在主链的数据库里留下记录， 这个其实就是所谓的“DAPP账户”。 这个账户也有一系列的属性，比如应用id，余额等。这里的余额指的是所有Dapp用户往应用里充值的一个总和，也是我们在“应用中心”-> "已安装应用"里点击“余额详情”时看到的数字。 “系统账户”笼统的来说也就是这个账户，而不是一个具体的、有主密码对应的账户。

## 三、Dapp 资产提现到主链

前面讲了从主链如何充值到侧链的Dapp以及DAPP账户的含义，那么如何从Dapp内部把资产提现到主链呢？（注意能够提现到主链的资产只能是主链上发行的资产，侧链内部发行的资产无法提现到主链。 ）

Dapp开发者可以参考开发文档，在应用内部实现提现的功能。但是需要注意的是，由于从侧链Dapp提现到主链，需要对主链进行写操作，所以主链会收取0.1XAS作为手续费。 在Dapp内部，开发者可以为“提现”这步操作定义手续费，所以一个提现操作，是需要消耗两笔手续费的：一笔是主链收取的0.1XAS，一笔是Dapp内部自定义的手续费。 

如果用户在Dapp内部没有XAS， 是否可以提现成功呢？目前的版本（1.3.5）是可以的。此时用户消耗的XAS便是上一部分说到的“DAPP账户”这个账户的XAS余额(如果Dapp账户没有余额则会失败)，这样的话DAPP整体余额便会相对于内部XAS总量少了0.1XAS。用户提现这个操作相当于“冻结”了DAPP的0.1XAS。 所以Dapp开发者如果提供了提现的这个功能，那就需要新建一个手续费账户，用于用户提现时的消耗。  在后续的版本中，阿希会升级为扣取用户主链上的XAS资产，减少用户的操作步骤及Dapp开发者的负担。

如果Dapp开发者想要用户承担提现的手续费，目前该怎么操作？ 以下以XCT为例，提供一个流程作为参考：
```
假设当前DAPP XAS余额为x. 某特定用户在DAPP内的XAS余额为z(z>0.1)，z 已经包含在x之
1. 新建一个手续费账户，充值y数量的XAS进去，当作手续费。此时DAPP 的XAS余额为(x+y)
2. 针对提现操作，内部手续费0.1 XAS, 主链收取 0.1 XAS
3. 用户提现一笔XCT交易成功。 此时用户在DAPP内的XAS余额为(z-0.1), 当前 DAPP 整体XAS 余额为(x+y-0.1), 手续费账户余额为y不变
4. 手续费账户余额显示为y，实际冻结0.1XAS, 可提现(y-0.1)XAS  
5. 提现时消耗在内部的手续费实为受托人所得， 如果受托人都在DAPP方， 实际上最终提现的手续费都由用户承担。 
```
